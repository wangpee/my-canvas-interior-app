<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ax3InteriAI - Dual AI Interior Designer</title>
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/lucide-react@latest"></script>

    <style>
        @keyframes fade-in { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fade-in 0.5s ease-out forwards; }
        @keyframes progress { 0% { transform: scaleX(0); } 100% { transform: scaleX(0.9); } }
        .animate-progress { animation: progress 15s ease-out forwards; }
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;
        const { 
            Upload, Sparkles, RefreshCw, Download, 
            Layout, Palette, X, AlertCircle, Wand2, 
            SlidersHorizontal, ChevronDown 
        } = lucideReact;

        // --- API CONFIGURATION ---
        const API_KEY = "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";

        const ROOM_TYPES = [
            { id: 'living_room', label: 'Living Room' },
            { id: 'bedroom', label: 'Bedroom' },
            { id: 'kitchen', label: 'Kitchen' },
            { id: 'office', label: 'Home Office' }
        ];

        const STYLES = [
            { id: 'modern', name: 'Modern', description: 'Clean lines, neutral colors', promptModifier: 'modern minimalist style, clean lines, neutral colors', color: 'bg-stone-100' },
            { id: 'boho', name: 'Bohemian', description: 'Eclectic and cozy', promptModifier: 'bohemian chic, rattan furniture, plants, warm tones', color: 'bg-orange-50' },
            { id: 'industrial', name: 'Industrial', description: 'Raw materials, metal accents', promptModifier: 'industrial loft, exposed brick, metal accents', color: 'bg-slate-200' },
            { id: 'scandi', name: 'Scandinavian', description: 'Bright, airy, functional', promptModifier: 'scandinavian style, hygge, light wood', color: 'bg-blue-50' }
        ];

        const ComparisonSlider = ({ beforeImage, afterImage }) => {
            const [sliderPosition, setSliderPosition] = useState(50);
            const containerRef = useRef(null);
            const isDragging = useRef(false);

            const handleMove = (e) => {
                if (!isDragging.current || !containerRef.current) return;
                const rect = containerRef.current.getBoundingClientRect();
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const x = Math.max(0, Math.min(clientX - rect.left, rect.width));
                setSliderPosition((x / rect.width) * 100);
            };

            useEffect(() => {
                const stop = () => isDragging.current = false;
                window.addEventListener('mouseup', stop);
                window.addEventListener('touchend', stop);
                return () => { window.removeEventListener('mouseup', stop); window.removeEventListener('touchend', stop); };
            }, []);

            return (
                <div 
                    ref={containerRef}
                    className="relative w-full h-[400px] md:h-[500px] rounded-2xl overflow-hidden cursor-ew-resize select-none shadow-2xl border border-gray-200"
                    onMouseMove={handleMove} onTouchMove={handleMove}
                    onMouseDown={() => isDragging.current = true} onTouchStart={() => isDragging.current = true}
                >
                    <img src={afterImage} className="absolute top-0 left-0 w-full h-full object-cover" />
                    <div className="absolute top-0 left-0 h-full overflow-hidden border-r-2 border-white" style={{ width: `${sliderPosition}%` }}>
                        <img src={beforeImage} className="absolute top-0 left-0 h-full object-cover" style={{ width: containerRef.current?.offsetWidth }} />
                        <div className="absolute top-4 left-4 bg-black/60 text-white text-xs font-bold px-2 py-1 rounded backdrop-blur-sm">ORIGINAL</div>
                    </div>
                    <div className="absolute top-0 bottom-0 w-1 bg-white flex items-center justify-center" style={{ left: `${sliderPosition}%` }}>
                        <div className="w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-lg transform -translate-x-1/2">
                            <SlidersHorizontal className="w-5 h-5 text-indigo-600" />
                        </div>
                    </div>
                    <div className="absolute top-4 right-4 bg-indigo-600/90 text-white text-xs font-bold px-2 py-1 rounded backdrop-blur-sm shadow-sm">REDESIGNED</div>
                </div>
            );
        };

        function App() {
            const [appState, setAppState] = useState('landing');
            const [uploadedImage, setUploadedImage] = useState(null);
            const [generatedImage, setGeneratedImage] = useState(null);
            const [selectedRoomType, setSelectedRoomType] = useState(ROOM_TYPES[0].id);
            const [selectedStyle, setSelectedStyle] = useState(null);
            const [error, setError] = useState(null);

            const handleImageUpload = (e) => {
                const file = e.target.files?.[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => { setUploadedImage(reader.result); setAppState('styles'); };
                    reader.readAsDataURL(file);
                }
            };

            const callOpenAI = async (prompt) => {
                const response = await fetch('https://api.openai.com/v1/images/generations', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${API_KEY}` },
                    body: JSON.stringify({
                        model: "dall-e-3",
                        prompt: `Keep the exact architectural layout and window placement of the user's room, but redesign the interior as a ${prompt}. Photorealistic, high detail.`,
                        n: 1,
                        size: "1024x1024",
                        response_format: "b64_json"
                    })
                });
                const data = await response.json();
                if (!response.ok) throw new Error(data.error?.message || "OpenAI Error");
                return `data:image/png;base64,${data.data[0].b64_json}`;
            };

            const callGemini = async (prompt, base64) => {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }, { inlineData: { mimeType: "image/jpeg", data: base64 } }] }],
                        generationConfig: { responseModalities: ["IMAGE"] }
                    })
                });
                const data = await response.json();
                if (!response.ok) throw new Error(data.error?.message || "Gemini Error");
                const b64 = data.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;
                return b64 ? `data:image/jpeg;base64,${b64}` : null;
            };

            const generate = async () => {
                if (!API_KEY) return setError("Missing API Key.");
                setAppState('generating');
                try {
                    const label = ROOM_TYPES.find(r => r.id === selectedRoomType).label;
                    const prompt = `${label} in ${selectedStyle.promptModifier}`;
                    const isOpenAI = API_KEY.startsWith('sk-');
                    
                    const result = isOpenAI 
                        ? await callOpenAI(prompt) 
                        : await callGemini(prompt, uploadedImage.split(',')[1]);
                    
                    if (result) { setGeneratedImage(result); setAppState('results'); }
                } catch (err) { setError(err.message); setAppState('styles'); }
            };

            return (
                <div className="min-h-screen flex flex-col">
                    <header className="bg-white border-b p-4 sticky top-0 z-50 flex justify-between items-center px-8">
                        <div className="flex items-center gap-2 cursor-pointer" onClick={() => setAppState('landing')}>
                            <div className="bg-indigo-600 text-white p-1.5 rounded-lg"><Layout size={20} /></div>
                            <span className="font-bold text-xl tracking-tighter italic">Ax3InteriAI</span>
                        </div>
                        <div className="text-[10px] uppercase font-bold tracking-widest text-gray-400 border px-3 py-1 rounded-full">
                            Provider: {API_KEY.startsWith('sk-') ? 'OpenAI DALL-E 3' : 'Google Gemini'}
                        </div>
                    </header>

                    <main className="flex-grow flex flex-col items-center">
                        {error && <div className="max-w-xl w-full mx-auto mt-6 p-4 bg-red-50 text-red-700 rounded-xl flex justify-between"><span>{error}</span><X className="cursor-pointer" onClick={() => setError(null)} /></div>}

                        {appState === 'landing' && (
                            <div className="max-w-4xl text-center py-24 px-4 animate-fade-in">
                                <div className="bg-indigo-100 w-24 h-24 rounded-3xl flex items-center justify-center mx-auto mb-10 shadow-inner"><Wand2 size={48} className="text-indigo-600" /></div>
                                <h1 className="text-5xl md:text-7xl font-black mb-6 text-gray-900 leading-tight">Redesign your home <br/><span className="text-indigo-600">with magic AI.</span></h1>
                                <p className="text-xl text-gray-500 mb-12 max-w-2xl mx-auto">Instant interior design transformations using your own photos.</p>
                                
                                <div className="flex flex-col items-center gap-6">
                                    <div className="relative group">
                                        <select value={selectedRoomType} onChange={(e) => setSelectedRoomType(e.target.value)} className="appearance-none bg-white border-2 border-gray-100 hover:border-indigo-200 p-4 w-72 rounded-2xl font-bold text-gray-700 shadow-sm outline-none transition-all">
                                            {ROOM_TYPES.map(r => <option key={r.id} value={r.id}>{r.label}</option>)}
                                        </select>
                                        <ChevronDown className="absolute right-4 top-5 text-gray-400 pointer-events-none" />
                                    </div>
                                    <label className="bg-gray-900 text-white px-12 py-5 rounded-full text-lg font-black cursor-pointer hover:bg-black hover:scale-105 transition-all shadow-xl active:scale-95">
                                        Upload Room Photo
                                        <input type="file" className="hidden" accept="image/*" onChange={handleImageUpload} />
                                    </label>
                                </div>
                            </div>
                        )}

                        {appState === 'styles' && (
                            <div className="max-w-5xl w-full p-8 animate-fade-in">
                                <h2 className="text-3xl font-black mb-10 text-center">Pick your aesthetic</h2>
                                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
                                    {STYLES.map(s => (
                                        <button key={s.id} onClick={() => setSelectedStyle(s)} className={`p-8 rounded-3xl border-2 text-left transition-all ${selectedStyle?.id === s.id ? 'border-indigo-600 bg-indigo-50 scale-105 shadow-xl' : 'bg-white border-gray-100 hover:border-indigo-200'}`}>
                                            <div className={`w-12 h-12 rounded-2xl flex items-center justify-center mb-6 ${s.color} shadow-sm`}><Palette size={24} /></div>
                                            <h3 className="font-bold text-lg mb-2">{s.name}</h3>
                                            <p className="text-xs text-gray-400 leading-relaxed">{s.description}</p>
                                        </button>
                                    ))}
                                </div>
                                <button onClick={generate} disabled={!selectedStyle} className="w-full bg-indigo-600 text-white py-5 rounded-3xl text-xl font-black shadow-2xl disabled:bg-gray-200 transition-all hover:bg-indigo-700">Apply Design</button>
                            </div>
                        )}

                        {appState === 'generating' && (
                            <div className="flex-grow flex flex-col items-center justify-center py-32 text-center">
                                <div className="w-24 h-24 border-8 border-indigo-600 border-t-transparent rounded-full animate-spin mb-10"></div>
                                <h2 className="text-3xl font-black mb-4">Crafting your new room...</h2>
                                <p className="text-gray-400">High-fidelity rendering in progress.</p>
                                <div className="w-64 bg-gray-100 h-2 mt-10 rounded-full overflow-hidden">
                                    <div className="bg-indigo-600 h-full animate-progress origin-left"></div>
                                </div>
                            </div>
                        )}

                        {appState === 'results' && (
                            <div className="max-w-6xl w-full p-8 animate-fade-in">
                                <div className="flex justify-between items-end mb-10">
                                    <div>
                                        <h2 className="text-4xl font-black">Design Complete</h2>
                                        <p className="text-gray-400">Your {ROOM_TYPES.find(r => r.id === selectedRoomType).label} has been transformed.</p>
                                    </div>
                                    <button onClick={() => setAppState('landing')} className="bg-white border-2 border-gray-100 px-6 py-3 rounded-2xl font-bold hover:bg-gray-50 transition-all">New Transformation</button>
                                </div>
                                <div className="grid grid-cols-1 gap-12">
                                    <ComparisonSlider beforeImage={uploadedImage} afterImage={generatedImage} />
                                    <a href={generatedImage} download="redesign.png" className="w-full bg-gray-900 text-white py-5 rounded-3xl text-xl font-black text-center shadow-xl hover:bg-black transition-all">Download HD Result</a>
                                </div>
                            </div>
                        )}
                    </main>

                    <footer className="p-8 text-center text-gray-400 text-[10px] tracking-widest font-bold border-t">
                        POWERED BY MULTIMODAL AI & AX3INTERIAI
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
