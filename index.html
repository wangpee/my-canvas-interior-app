<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ax3InteriAI - AI Interior Design</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/img-comparison-slider@8/dist/styles.css" />
    <script defer src="https://cdn.jsdelivr.net/npm/img-comparison-slider@8/dist/index.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        img-comparison-slider { --divider-width: 2px; --divider-color: #4f46e5; width: 100%; border-radius: 1rem; overflow: hidden; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="bg-gray-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const STYLES = [
            { id: 'modern', name: 'Modern Minimalist', prompt: 'modern minimalist style, clean lines, neutral colors' },
            { id: 'boho', name: 'Bohemian Chic', prompt: 'bohemian chic, organic textures, plants, cozy' },
            { id: 'industrial', name: 'Industrial Loft', prompt: 'industrial loft, exposed brick, metal accents, leather' },
            { id: 'japandi', name: 'Japandi', prompt: 'Japandi style, Japanese rustic minimalism, Scandi functionality' }
        ];

        function App() {
            const [view, setView] = useState('login');
            const [apiKey, setApiKey] = useState('');
            const [originalImg, setOriginalImg] = useState(null);
            const [variations, setVariations] = useState([]);
            const [selectedIndex, setSelectedIndex] = useState(0);
            const [isGenerating, setIsGenerating] = useState(false);
            const [refineColor, setRefineColor] = useState('');

            const handleUpload = (e) => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onloadend = () => { setOriginalImg(reader.result); setView('styles'); };
                reader.readAsDataURL(file);
            };

            const callGemini = async (prompt, imageBase64) => {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [
                                { text: prompt },
                                { inlineData: { mimeType: "image/jpeg", data: imageBase64.split(',')[1] } }
                            ]
                        }],
                        generationConfig: { responseModalities: ["IMAGE"] }
                    })
                });
                const data = await response.json();
                if (data.error) throw new Error(data.error.message);
                return `data:image/jpeg;base64,${data.candidates[0].content.parts.find(p => p.inlineData).inlineData.data}`;
            };

            const generate = async (style) => {
                setIsGenerating(true);
                setView('loading');
                try {
                    const prompt = `Redesign this interior in a ${style}. Keep layout identical. Photorealistic.`;
                    const result = await callGemini(prompt, originalImg);
                    setVariations([result]);
                    setSelectedIndex(0);
                    setView('results');
                } catch (e) { alert(e.message); setView('styles'); }
                setIsGenerating(false);
            };

            const generateMore = async () => {
                setIsGenerating(true);
                try {
                    const style = STYLES.find(s => s.id === 'modern').prompt; // Simplified for demo
                    const result = await callGemini(`A new variation of this room in ${style}`, originalImg);
                    setVariations([...variations, result]);
                    setSelectedIndex(variations.length);
                } catch (e) { alert(e.message); }
                setIsGenerating(false);
            };

            // --- UI Screens ---
            if (view === 'login') return (
                <div className="min-h-screen flex items-center justify-center p-6">
                    <div className="bg-white p-8 rounded-2xl shadow-xl max-w-sm w-full">
                        <h1 className="text-3xl font-bold mb-2 text-indigo-600">Ax3InteriAI</h1>
                        <p className="text-gray-500 mb-6 italic">Built for the future of interior design.</p>
                        <input type="password" placeholder="Enter Gemini API Key" className="w-full p-3 border rounded-lg mb-4 outline-none focus:ring-2 focus:ring-indigo-500" value={apiKey} onChange={(e) => setApiKey(e.target.value)} />
                        <label className="block w-full text-center bg-indigo-600 text-white py-3 rounded-lg font-bold cursor-pointer hover:bg-indigo-700 transition-colors">
                            Upload Room Image
                            <input type="file" className="hidden" onChange={handleUpload} />
                        </label>
                    </div>
                </div>
            );

            if (view === 'loading') return (
                <div className="min-h-screen flex flex-col items-center justify-center">
                    <div className="w-12 h-12 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin mb-4"></div>
                    <p className="text-xl font-medium">Creating your new space...</p>
                </div>
            );

            if (view === 'results') return (
                <div className="max-w-6xl mx-auto p-6 md:p-10">
                    <div className="flex justify-between items-center mb-8">
                        <h2 className="text-3xl font-bold">Your Redesign</h2>
                        <button onClick={() => setView('login')} className="text-indigo-600 font-semibold">Start New</button>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-10">
                        <div className="lg:col-span-2 space-y-6">
                            <img-comparison-slider>
                                <img slot="first" src={originalImg} />
                                <img slot="second" src={variations[selectedIndex]} />
                            </img-comparison-slider>
                            
                            <div className="flex gap-4 overflow-x-auto pb-4 no-scrollbar">
                                <button onClick={generateMore} className="flex-shrink-0 w-24 h-16 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center text-gray-400 hover:border-indigo-500 hover:text-indigo-500 transition-all">
                                    {isGenerating ? "..." : "+ New"}
                                </button>
                                {variations.map((img, i) => (
                                    <img key={i} src={img} onClick={() => setSelectedIndex(i)} className={`flex-shrink-0 w-24 h-16 rounded-lg object-cover cursor-pointer border-2 ${selectedIndex === i ? 'border-indigo-600' : 'border-transparent'}`} />
                                ))}
                            </div>
                        </div>

                        <div className="bg-white p-6 rounded-2xl shadow-md border border-gray-100">
                            <h3 className="font-bold text-lg mb-4">Customize</h3>
                            <div className="space-y-4">
                                <div>
                                    <label className="text-xs font-bold text-gray-400 uppercase">Change Colors</label>
                                    <input type="text" placeholder="e.g. Sage Green Walls" className="w-full mt-1 p-2 border rounded-lg" value={refineColor} onChange={(e) => setRefineColor(e.target.value)} />
                                </div>
                                <button onClick={() => alert('Refining color...')} className="w-full bg-slate-900 text-white py-2 rounded-lg font-medium">Apply Change</button>
                                <hr />
                                <a href={variations[selectedIndex]} download="ax3-redesign.jpg" className="block text-center w-full bg-indigo-600 text-white py-2 rounded-lg font-medium">Download Image</a>
                            </div>
                        </div>
                    </div>
                </div>
            );

            return (
                <div className="max-w-4xl mx-auto p-10">
                    <h2 className="text-3xl font-bold mb-8">Select a Style</h2>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        {STYLES.map(s => (
                            <button key={s.id} onClick={() => generate(s.prompt)} className="p-6 bg-white border border-gray-100 rounded-2xl shadow-sm hover:shadow-md hover:border-indigo-200 transition-all text-left">
                                <h3 className="font-bold text-lg">{s.name}</h3>
                                <p className="text-gray-500 text-sm">Apply {s.name.toLowerCase()} design to your photo.</p>
                            </button>
                        ))}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
